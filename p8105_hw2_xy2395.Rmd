---
title: "p8105_hw2_xy2395"
author: "Jack Yan"
date: "9/27/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(p8105.datasets)
# data(package = 'p8105.datasets',  brfss_smart2010)
```

```{r, eval = F}
library(tidyverse)
library(readxl)
library(p8105.datasets)
```

# Problem 1

## Data import and manipulation

```{r echo=T, eval = F}
data_nysubway = 
  read_csv(file = "./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor::clean_names() %>% 
  select(-division, -exit_only, -(staffing:staff_hours), -(ada_notes:entrance_location)) %>% 
  mutate( entry = recode(entry, "YES" = TRUE, "NO" = FALSE))
```

```{r, include = FALSE}
data_nysubway = 
  read_csv(file = "./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor::clean_names() %>% 
  select(-division, -exit_only, -(staffing:staff_hours), -(ada_notes:entrance_location)) %>% 
  mutate( entry = recode(entry, "YES" = TRUE, "NO" = FALSE))
```

The code above imported data from the `.csv` file, and cleaned up variable names using `clean_names` function. It also selected variables to be used from the original dataset. Further, it converted the entry variable from character (`YES` vs `NO`) to a logical variable. Now the dataset contains variables of line, station name, station latitude & longitude, routes served, entrance type, entry, vending, and ADA compliance. Now the dataset has `r nrow(data_nysubway)` rows (observations) and  `r ncol(data_nysubway)` columns (variables). The data are not yet tidy, because the routes that each station supports are spead along variables from route1 to route11. I will fix this problem in Question 4.

A datailed list of variables in this dataset is shown below:

```{r}
names(data_nysubway)
```


## Questions

### Question 1

```{r}
data_nysubway = mutate(data_nysubway, station_name_line = paste(station_name, line) )
distinct_station_name_line = distinct(data_nysubway, station_name_line)
nrow(distinct_station_name_line)
```

There are `r nrow(distinct_station_name_line)` stations.

### Question 2
```{r}
data_nysubway %>% 
  filter(ada == TRUE) %>% 
  distinct(station_name_line) %>% 
  nrow()
```

There are 84 ADA compliant stations.

### Question 3
```{r}
n_without_vending =
  data_nysubway %>% 
  filter( vending == "NO") %>% 
  nrow()

n_without_vending_allow_entrance = 
  data_nysubway %>% 
  filter( vending == "NO") %>% 
  filter( entry == TRUE) %>% 
  nrow()

n_without_vending_allow_entrance / n_without_vending
```

The proportion of station entrances / exits without vending allow entrance is `r round(n_without_vending_allow_entrance / n_without_vending, 2)`.

### Question 4

Use `gather` to tidy the data so that each value in the previous variables (from `route1` to `route11`) is gathered into a new variable `route_served`. Then filter out `NA`s and delete the unnecessary `route_number` variable.

```{r}
tidy_data_nysubway = 
  gather(data_nysubway, key = route_number, value = route_served, route1:route11) %>% 
  filter(route_served != 'NA') %>% 
  select(-route_number)

tidy_data_nysubway %>% 
  filter(route_served == "A") %>% 
  distinct(station_name_line) %>% 
  nrow()

tidy_data_nysubway %>% 
  filter(route_served == "A") %>% 
  filter(ada == TRUE) %>% 
  distinct(station_name_line) %>% 
  nrow()
```

There are 60 distinct stations serving the A train, and 17 of them are ADA compliant.

# Problem 2
```{r}
data_mrtw = 
  read_excel("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx",range = 'A2:N256') %>% 
  janitor::clean_names() %>% 
  filter(dumpster != "NA")
data_mrtw$sports_balls = as.integer(data_mrtw$sports_balls)
```

```{r}
data_prcpttn_2016 = 
    read_excel("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", sheet = '2016 Precipitation', range = "A2:B14") %>% 
    janitor::clean_names() %>% 
    filter(total != "NA") %>% 
    mutate(year = 2016)
    
data_prcpttn_2017 = 
    read_excel("./data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", sheet = '2017 Precipitation', range = "A2:B14")  %>% 
    janitor::clean_names() %>% 
    filter(total != "NA") %>% 
    mutate(year = 2017)

data_prcpttn = bind_rows(data_prcpttn_2016, data_prcpttn_2017) %>% 
    mutate(month = month.name[month]) %>% 
    select(year, month, total)
```

Write a paragraph about these data; you are encouraged to use inline R. Be sure to note the number of observations in both resulting datasets, and give examples of key variables. For available data, what was the total precipitation in 2017? What was the median number of sports balls in a dumpster in 2016?

# Problem 3

```{r}
tidy_brfss = 
  brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health")  %>% 
  select(-(class:question), -sample_size, -(confidence_limit_low : geo_location)) %>% 
  arrange(locationdesc)
  
structured_brfss = 
  spread(tidy_brfss, key = response, value = data_value) %>% 
  janitor::clean_names() %>% 
  select(year, locationabbr, locationdesc, excellent, very_good, good, fair, poor) %>% 
  mutate(excellent_and_very_good = excellent + very_good)
  
```

```{r}
# How many unique locations are included in the dataset?
distinct(structured_brfss, locationdesc) %>% 
  nrow()
# Is every state represented? 
distinct(structured_brfss, locationabbr) %>% 
  nrow()
# What state is observed the most?
count(structured_brfss, locationabbr) %>% 
  arrange(desc(n)) %>% 
  head(1)
# In 2002, what is the median of the “Excellent” response value?
structured_brfss_2002 = filter(structured_brfss, year == 2002) 
median(structured_brfss_2002$excellent, na.rm = T)
# Make a histogram of “Excellent” response values in the year 2002
ggplot(structured_brfss_2002, aes(x = excellent)) + 
  geom_histogram()
# Make a scatterplot showing the proportion of “Excellent” response values in New York County and Queens County (both in NY State) in each year from 2002 to 2010.
structured_brfss_ny = 
  structured_brfss %>% 
  filter(year>=2002, year<=2010) %>% 
  filter(locationdesc == "NY - Queens County" | locationdesc ==  "NY - New York County")

ggplot(structured_brfss_ny, aes(x = year, y = excellent)) + 
  geom_point(aes(color = locationdesc))

```


